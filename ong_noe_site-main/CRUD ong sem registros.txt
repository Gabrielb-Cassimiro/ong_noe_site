CREATE DATABASE IF NOT EXISTS ong_noe_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE ong_noe_db;

-- Tabela de Usuários (Requisito PDF: Login e Senha, Perfis Master/Comum)
CREATE TABLE usuarios (
    id_usuario INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(80) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    login VARCHAR(6) UNIQUE NOT NULL,
    senha VARCHAR(255) NOT NULL,
    tipo_usuario ENUM('master', 'comum') NOT NULL DEFAULT 'comum',
    status ENUM('ativo', 'inativo') DEFAULT 'ativo',
    data_cadastro TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabela de Dados Pessoais (Requisito PDF: Nome Materno e Data Nasc para 2FA)
CREATE TABLE dados_pessoais (
    id_dados INT AUTO_INCREMENT PRIMARY KEY,
    id_usuario INT NOT NULL,
    cpf VARCHAR(14) UNIQUE NOT NULL,
    nome_materno VARCHAR(80) NOT NULL,
    data_nascimento DATE NOT NULL,
    sexo ENUM('M', 'F', 'O'),
    telefone_celular VARCHAR(15),
    telefone_fixo VARCHAR(14),
    FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario) ON DELETE CASCADE
);

-- Tabela de Endereços (Requisito PDF: CEP para 2FA)
CREATE TABLE enderecos (
    id_endereco INT AUTO_INCREMENT PRIMARY KEY,
    id_usuario INT NOT NULL,
    cep VARCHAR(9) NOT NULL,
    logradouro VARCHAR(100),
    numero VARCHAR(10),
    complemento VARCHAR(50),
    bairro VARCHAR(50),
    cidade VARCHAR(50),
    estado VARCHAR(2),
    FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario) ON DELETE CASCADE
);

-- Tabela de Logs (Requisito PDF: Registro de Autenticação)
CREATE TABLE logs_autenticacao (
    id_log INT AUTO_INCREMENT PRIMARY KEY,
    id_usuario INT NOT NULL,
    data_hora TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    status_login ENUM('sucesso', 'falha') NOT NULL,
    tipo_2fa VARCHAR(50),
    ip_origem VARCHAR(45),
    FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario) ON DELETE CASCADE
);

-- Tabela de Produtos (Para o Carrossel e Loja - Seu Requisito Extra)
CREATE TABLE produtos (
    id_produto INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    descricao TEXT,
    preco DECIMAL(10,2) NOT NULL,
    imagem_url VARCHAR(255),
    estoque INT DEFAULT 0
);

-- Inserção do Usuário Master Padrão (Requisito PDF) 
-- Senha padrão: admin123 (Hash gerado via password_hash)
INSERT INTO usuarios (nome, email, login, senha, tipo_usuario) VALUES 
('Administrador Master', 'admin@ongdenoe.com', 'master', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'master');

-- Inserção de Produtos Iniciais para o Carrossel
INSERT INTO produtos (nome, descricao, preco, imagem_url, estoque) VALUES
('Ração Premium 15kg', 'Nutrição completa para cães adultos.', 149.90, 'https://via.placeholder.com/300x200?text=Racao+Premium', 20),
('Coleira Ajustável', 'Conforto e segurança para o passeio.', 35.00, 'https://via.placeholder.com/300x200?text=Coleira', 50),
('Brinquedo Mordedor', 'Resistente e divertido.', 19.90, 'https://via.placeholder.com/300x200?text=Brinquedo', 30);